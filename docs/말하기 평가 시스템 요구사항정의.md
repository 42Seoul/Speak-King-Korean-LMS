# [요구사항 정의서] Next.js 기반 한국어 말하기 연습 모듈 (Ver 2.0)

## 1. 프로젝트 개요
*   **목표:** 사용자가 브라우저 환경에서 원어민 음성을 듣고 따라 말하면, AI가 실시간으로 텍스트를 인식하여 정확도를 평가하는 웹 애플리케이션.
*   **핵심 초점:** 안정적인 오디오 재생, 끊김 없는 음성 인식, 기본적인 텍스트 유사도 평가.
*   **타겟 환경:** PC 및 모바일 웹 브라우저 (Chrome, Edge, Safari 등).

---

## 2. 상세 기능 요구사항 (Functional Requirements)

### 2.1 초기화 및 자원 로딩 (Initialization)
Next.js의 특성을 고려하여 클라이언트 환경을 보장해야 한다.

*   **REQ-01 [클라이언트 환경 격리]:** 음성 인식(`SpeechRecognition`) 및 오디오 객체(`Audio`)는 서버 사이드 렌더링(SSR) 과정에서 제외하고, 반드시 클라이언트 마운트 이후(`useEffect`)에 초기화해야 한다.
*   **REQ-02 [HTTPS 필수]:** 브라우저 보안 정책상 마이크 접근을 위해 배포 환경은 HTTPS 프로토콜을 준수해야 한다.
*   **REQ-03 [브라우저 호환성 처리]:** `Web Speech API` 미지원 브라우저 접속 시, 기능 제한 알림 모달을 표시하고 텍스트 읽기 모드로 전환한다.
*   **REQ-04 [오디오 프리로딩]:** 별도의 다운로드 로직 없이 브라우저 캐시를 활용하되, 끊김 방지를 위해 `audio` 태그의 `preload="auto"` 속성을 활용한다.

### 2.2 오디오 재생 (Audio Playback)
자동 재생 정책 준수 및 재생 흐름을 제어한다.

*   **REQ-05 [최초 재생 트리거]:** 학습 세션 진입 시, "학습 시작" 버튼 클릭 등 사용자의 명시적 액션을 통해 `AudioContext`를 활성화한다.
*   **REQ-06 [재생 중 입력 차단]:** 원어민 오디오가 재생되는 동안에는 음성 인식을 일시 중지(Stop)하거나 입력을 무시하여, 스피커 소리가 마이크로 유입되는 에코 현상을 방지한다.
*   **REQ-07 [재생 완료 이벤트]:** 오디오 재생이 끝나는 즉시(`onEnded`) 음성 인식을 시작(`start`)하고, '다음 버튼 노출 타이머'를 동작시킨다.

### 2.3 음성 인식 (Speech Recognition)
브라우저 내장 API를 활용하여 실시간 텍스트를 확보한다.

*   **REQ-08 [실시간 시각화]:** 사용자가 말하는 내용을 실시간으로 텍스트로 변환하여 화면에 표시한다. (Interim Results 활용)
*   **REQ-09 [연결 유지]:** 브라우저가 음성 인식을 임의로 중단(`onend`)하더라도, 사용자가 명시적으로 중지하거나 정답을 맞히기 전까지는 자동으로 재연결을 시도한다.
*   **REQ-10 [인식 초기화]:** 문장이 변경될 때마다 이전 문장의 인식 결과(`transcript`)를 반드시 초기화하여, 오평가를 방지한다.

### 2.4 평가 및 채점 로직 (Evaluation Engine)
복잡한 자모 분리 대신, 표준 텍스트 비교 방식을 사용한다.

*   **REQ-11 [텍스트 정규화 (Normalization)]:**
    *   정답 문장과 사용자 인식 문장 모두 **특수문자(.,?! 등) 제거** 및 **공백 제거** 과정을 거친다.
    *   (선택 사항) 영어 대소문자가 섞여 있을 경우 소문자로 통일한다.
*   **REQ-12 [유사도 측정]:**
    *   정규화된 두 문자열 간의 **레벤슈타인 거리(Levenshtein Distance)**를 계산하여 유사도 퍼센트(%)를 산출한다.
    *   (보완) 사용자의 문장에 정답 문장이 포함(Contains)되어 있는 경우도 100점으로 간주한다. (예: "음.. 안녕하세요" -> 정답 "안녕하세요" 포함 시 정답)
*   **REQ-13 [자동 통과 기준]:**
    *   유사도가 **70% 이상**일 경우: 즉시 '성공' 상태로 전환, 정답 효과음 재생, 1.5초 후 다음 문장으로 자동 이동.

### 2.5 학습 흐름 제어 (Flow Control)
사용자 선택권을 보장하기 위한 스킵 로직을 정의한다.

*   **REQ-14 [수동 넘어가기 (Skip) 활성화 조건]:**
    *   발음 평가 점수와 무관하게, **오디오 재생이 종료된 시점부터 4초가 경과**하면 '다음' 버튼(또는 스킵 버튼)이 화면에 나타나야 한다.
    *   사용자가 발음을 힘들어하거나 음성 인식이 잘 안 될 경우, 이 버튼을 눌러 다음 문장으로 넘어갈 수 있다.
*   **REQ-15 [세션 완료]:** 마지막 문장까지 학습이 끝나면 결과 페이지로 이동하여 학습 데이터를 저장한다.

---

## 3. 비기능 요구사항 (Non-Functional Requirements)

*   **NFR-01 [반응형 UI]:** 모바일 및 데스크톱 해상도를 모두 지원해야 한다.
*   **NFR-02 [오디오 지연 최소화]:** 버튼 클릭 또는 자동 재생 시점과 실제 소리 출력 간의 지연(Latency)을 최소화한다.
*   **NFR-03 [권한 에러 처리]:** 마이크 권한 거부(`NotAllowedError`) 시, 브라우저 설정 안내 가이드를 제공해야 한다.

---

## 4. UI/UX 요구사항 (UI Guidelines)

*   **UI-01 [상태 표시]:** 현재 상태를 명확히 구분하여 아이콘/색상으로 표시한다.
    *   🔈 재생 중 (입력 불가)
    *   🎙️ 듣는 중 (말하세요)
    *   ✅ 정답 (초록색)
*   **UI-02 [다음 버튼 인터랙션]:**
    *   초기 상태: 버튼 숨김 (Hidden) 또는 비활성(Disabled).
    *   노출 시점: 오디오 재생 종료 후 4초 뒤.
    *   애니메이션: 사용자의 시선을 끌 수 있도록 부드럽게 페이드 인(Fade-in) 되며 나타난다.

---

## 5. 제외 사항 (Out of Scope)
*   한글 자모 단위 분해 및 정밀 평가 로직.
*   발음 실패 시 힌트 제공 기능.
*   사용자 음성 녹음 파일 서버 저장.